---
title: "homework"
output: github_document
date: "2022-11-14"
---

## Problem 2

```{r}
library(tidyverse) 

homicide_df =
  read_csv("Data/homicide-data.csv") %>%
  janitor::clean_names()
```

This dataset includes homicides in the 50 largest US cities. The variables included in this dataset is uid, reported_date (date that the homicide was report), victim_last (last name of victim), victim_first (first name of victim), victim_age (age of victim), victim_sex (sex of victim), city (city where the homicide occured), state (state where the homicide occured), lat (latitude where the homicide occured), lon (longitude where the homicide occured), and disposition (current state of the case). 

```{r}

library(tidyverse) 
library(dplyr)

homicide_df =
  read_csv("Data/homicide-data.csv") %>%
  janitor::clean_names() %>% 
  mutate(city = str_c(city,", ")) %>% 
  mutate(city_state = paste0(city, state)) 
  
totalhomicide_df =
  homicide_df %>% 
  group_by(city_state) %>% 
  summarize(totalhomicides = n_distinct(uid)) 

openhomicides_df = 
  homicide_df %>% 
  filter(disposition == "Closed without arrest" | disposition == "Open/No arrest",     na.rm=TRUE) %>% 
  group_by(city_state) %>% 
  summarize(openhomicides = n())

totalhomicide_df = 
  left_join(totalhomicide_df, openhomicides_df, by = "city_state") %>% 
  mutate(totalhomicides = as.numeric(totalhomicides), openhomicides = as.numeric(openhomicides)) %>% 
  drop_na() 

```

Proportion of homicides in Baltimore, MD: 

```{r}


city_df = 
    totalhomicide_df %>% 
    filter(city_state == "Baltimore, MD") 

prop_function = function(city_df) {
  city_prop_test = 
  prop.test(x = city_df %>% pull(openhomicides), n = city_df %>% pull(totalhomicides), p = NULL, alternative = c("two.sided"), conf.level = 0.95, correct = TRUE) %>% 
  broom::tidy()

prop_keep = 
  city_prop_test %>% 
  select(estimate, conf.high, conf.low) 
}
  

baltimore_prop_test = 
  prop_function(city_df) %>% 
  mutate(city_state = "Baltimore,MD")



```

Proportion of homicides in all 50 cities: 

```{r}
allcity_df = tibble() 

for (i in 1:50) {
  city_df = 
    totalhomicide_df %>% 
    filter(city_state == totalhomicide_df[[i,1]])

allcity_results = 
  prop_function(city_df) %>% 
  mutate(city_state = totalhomicide_df[[i,1]])

allcity_df = bind_rows(allcity_df, allcity_results)
  
}


  
```

```{r}
ggplot(allcity_df, aes(x = city_state, y = estimate)) + geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high), position = "dodge", width = 0.2)
```


## Problem 3

```{r}
library(tidyverse)
library(rvest)

set.seed(1)

sample = rnorm(30, mean = 0, sd = 5)

test_results = t.test(sample)

sim_t_test = function(n, mean, sd) {
sample = rnorm(n, mean, sd)

test_results = t.test(sample)

test_results %>% 
  broom::tidy() %>% 
  mutate(mean = mean)
}

test_df = sim_t_test(n = 30, mean = 0, sd = 5)

output = vector("list", 5000)

for (i in 1:5000) {
  output[[i]] = sim_t_test(n = 30, mean = 0, sd = 5)
}

ttest_sim_results = bind_rows(output) 

variousmeans_sim_results = tibble()
 
for (mean in 0:6) {
  output = vector("list", 5000)
  for (i in 1:5000) {
  output[[i]] = sim_t_test(n = 30, mean = mean, sd = 5)
  }
  sim_results = bind_rows(output)
  variousmeans_sim_results = bind_rows(variousmeans_sim_results, sim_results)
}
```


```{r}
propplot_df =
  variousmeans_sim_results %>% 
  group_by(mean) %>% 
  summarize(total = n()) 

reject_df = 
  variousmeans_sim_results %>% 
  group_by(mean) %>% 
  filter(p.value < 0.05, na.rm=TRUE) %>% 
  summarize(reject = n()) 

propplot_df = left_join(propplot_df, reject_df, by = "mean")

ggplot(propplot_df, aes(x = mean, y = reject)) + 
  geom_point() + scale_x_continuous(breaks = seq(0, 6, by = 1)) +  labs(
    title = "Proportion that the null was rejected",
    x = "Mean",
    y = "Power"
  )
```

```{r}
average_df = 
  variousmeans_sim_results %>% 
  group_by(mean) %>% 
  summarize(average_estimates = mean(estimate))

ggplot(average_df, aes(x = mean, y = average_estimates)) + 
  geom_point() + scale_x_continuous(breaks = seq(0, 6, by = 1)) +  labs(
    title = "Average estimates of the mean",
    x = "Mean",
    y = "Average Estimates"
  )

averagereject_df = 
  variousmeans_sim_results %>% 
  group_by(mean) %>%
  filter(p.value < 0.05, na.rm=TRUE) %>%
  summarize(average_estimates = mean(estimate))

ggplot(averagereject_df, aes(x = mean, y = average_estimates)) + 
  geom_point() + scale_x_continuous(breaks = seq(0, 6, by = 1)) +  labs(
    title = "Average estimates of the mean among rejected samples",
    x = "Mean",
    y = "Average Estimates"
  )

```

